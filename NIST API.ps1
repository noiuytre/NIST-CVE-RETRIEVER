param (
    [string]$CVE
)
# Check if $CVE is provided
if (-not $CVE) {
    Write-Host "Please provide a CVE as a parameter."
    exit
}
elseif ($CVE) {
    $CVE = $CVE.ToUpper()
}

# Define the URL
$url = "https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=$CVE"
#Write-Output $CVE

# Make the web request and get the JSON response
$response = Invoke-RestMethod -Uri $url -Method Get
# Check if the response contains data
if ($response.resultsPerPage -gt 0) {
    # Parse the JSON data
    $cveId = $response.vulnerabilities.cve.id
    $publishedDate = $response.vulnerabilities.cve.published
    $formatedPublishedDate = [datetime]::Parse($publishedDate)
    $lastModifiedDate = $response.vulnerabilities.cve.lastModified
    $formatedLastModifiedDate = [datetime]::Parse($lastModifiedDate)
    $sourceIdentifier = $response.vulnerabilities.cve.sourceIdentifier
    $description = $response.vulnerabilities[0].cve.descriptions | Where-Object { $_.lang -eq 'en' } | Select-Object -ExpandProperty value
    $cvssString = $response.vulnerabilities[0].cve.metrics.cvssMetricV31[0].cvssData.vectorString
    $base = $response.vulnerabilities[0].cve.metrics.cvssMetricV31[0].cvssData.baseScore.ToString() + " " + $response.vulnerabilities[0].cve.metrics.cvssMetricV31[0].cvssData.baseSeverity
    $exploitabilityScore = $response.vulnerabilities[0].cve.metrics.cvssMetricV31[0].exploitabilityScore
    $impactScore = $response.vulnerabilities[0].cve.metrics.cvssMetricV31[0].impactScore
    $CWE = $response.vulnerabilities[0].cve.weaknesses.description | Where-Object { $_.lang -eq 'en' } | Select-Object -ExpandProperty value
    $CVE_details_link = $response.vulnerabilities[0].cve.references.url
    $CVE_tags = $response.vulnerabilities[0].cve.references[0].tags



    # Output the parsed data
    Write-Host "`r`nCVE ID: $cveId"
    Write-Host "Published Date: $formatedPublishedDate"
    Write-Host "Last Modified Date: $formatedLastModifiedDate"
    Write-Host "Source Identifier: $sourceIdentifier"
    Write-Host "Description: $description"
    Write-Host "CVE String: $cvssString"
    Write-Host "Base Score and Impact: $base"
    Write-Host "Exploitability Score: $exploitabilityScore"
    Write-Host "Impact Score: $impactScore"
    Write-Host "CWE: $CWE"
    Write-Host "CVE Details Link: $CVE_details_link"
    Write-Host "Tags associated with the link: $($CVE_tags -join ', ')`r`n"


} else {
    Write-Host "Error: Unable to retrieve CVE information. /or/ No CVE found."
}
